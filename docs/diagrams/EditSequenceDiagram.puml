@startuml
actor User

User -> UI : Enters "edit-patient INDEX [fields]"
UI -> LogicManager : execute("edit-patient INDEX [fields]")

activate LogicManager
LogicManager -> AddressBookParser : parseCommand("edit-patient INDEX [fields]")

activate AddressBookParser
AddressBookParser -> EditPatientCommandParser : parse(arguments)
deactivate AddressBookParser

activate EditPatientCommandParser
EditPatientCommandParser -> EditPatientDescriptor ++: create descriptor\n(from prefixes)
EditPatientDescriptor --> EditPatientCommandParser
deactivate EditPatientDescriptor
EditPatientCommandParser --> EditPatientCommandParser : validate input\n(e.g. at least 1 field edited)
EditPatientCommandParser -> EditPatientCommand++: create EditPatientCommand with editedEntity
EditPatientCommand --> EditPatientCommandParser
deactivate EditPatientCommand
EditPatientCommandParser --> LogicManager: EditPatientCommand
deactivate EditPatientCommandParser

LogicManager -> Model : execute(EditPatientCommand)

activate Model
Model -> AddressBook : getFilteredList()
AddressBook --> Model : returns target list

Model -> Model : validate index\n(throws CommandException if invalid)

Model -> Entity : create editedEntity\n(immutable copy with updated fields)
Entity --> Model : returns editedEntity

Model -> AddressBook : setEntity(targetIndex, editedEntity)
AddressBook --> Model : entity replaced

Model -> VersionedAddressBook : commit()\n(save undo/redo state)
VersionedAddressBook --> Model : committed
deactivate Model

LogicManager -> Storage : saveAddressBook(VersionedAddressBook)
activate Storage
Storage --> LogicManager : success
deactivate Storage

LogicManager --> UI : CommandResult("Edited entity successfully")
deactivate LogicManager

UI -> UI : refresh displayed list
@enduml
